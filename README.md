# HEIC2any

基于 Python + Qt 的 HEIC 批量转换工具。支持并发处理、暂停/恢复/停止、拖拽添加文件、命名模板预览、导出参数随格式动态切换、重名文件处理策略、系统托盘后台运行与 Conda 环境发现。

## 主要特性
- 批量转换：HEIC→jpg/jpeg/png/tif/tiff/webp；支持尺寸与等比；关键参数一目了然
- 导出设置：主面板每种格式仅显示1–2个最重要参数；更多高级参数在弹窗中单独配置
- 并发性能：可调线程数，多线程处理；总进度与剩余数量可视化
- 过程控制：随时暂停/继续/停止；全部完成后“开始/暂停”按钮自动复位为“开始”
- 目录与命名：选择输入/输出目录、拖拽添加、命名 Token 预览（{name}/{index}/{date}/{datetime}/{width}/{height}）
- 重名策略：开始前预检同名输出，支持“替换/跳过/逐个决定”，并可在设置中设为默认策略
- 托盘与通知：最小化到托盘后台运行；通知可在设置中关闭；关闭行为可选择“直接退出/最小化后台运行”
- 环境支持：自动发现 Conda 环境并检测 Pillow/pillow‑heif 依赖
- 目录记忆：记住最近输入目录与默认输出目录；目录不存在时提示重新选择

## 安装与运行
1) 安装依赖（建议在 Conda 环境中）：
- `pip install -r requirements.txt`
- HEIC 支持依赖：`pillow-heif` 与 `Pillow`

2) 运行程序：
- `python main_heic2any.py`

## 使用指南
1) 添加文件/文件夹：左侧“添加文件/添加文件夹”或拖拽 .heic/.heif 进入队列。
2) 选择输出目录：左侧“选择输出目录”。若目录不存在，开始前会提示选择新目录。
3) 设置导出参数：右侧“导出设置”中选择格式，参数区随格式变化。
4) 更多设置：点击“更多设置…”，进入该格式的高级参数配置（保存为默认并用于后续任务）。
5) 开始处理：点击“开始”。开始前会自动将当前导出设置应用到所有未完成任务，并进行同名文件预检。

## 导出参数（主面板）
- JPEG/JPG：质量 1–95（常用 75–95）
- PNG：压缩等级 compress_level 0–9（9 体积最小最慢；常用 6–9）
- WEBP/TIFF：质量 1–100

## 更多设置（弹窗，按格式）
- JPEG/JPG：渐进式(Progressive)、优化(Optimize)、DPI‑X/DPI‑Y
- PNG：优化(Optimize)、DPI‑X/DPI‑Y
- WEBP：无损(Lossless)、方法(method 0–6)、DPI‑X/DPI‑Y
- TIFF：压缩方式（tiff_deflate/tiff_lzw/tiff_adobe_deflate）、DPI‑X/DPI‑Y

## 重名文件处理
- 开始前预检输出目录同名文件；策略可在“设置”中设为默认：
  - 替换：覆盖已存在文件
  - 跳过：标记任务为已取消并计入完成
  - 逐个决定：逐一提示替换/跳过/停止开始

## 应用设置
- 打开方式：左侧队列顶部“设置”按钮。
- 内容：
  - 是否打开通知（托盘气泡）
  - 关闭行为（首次关闭时也会弹窗询问并记住）：直接退出/最小化后台运行
  - 重名文件策略：替换/跳过/让我决定每个文件
  - 默认线程数、默认输出目录、最近输入目录等会自动记住

## Conda 环境
- 自动发现 Conda 环境并检测 `Pillow`/`pillow-heif`。若缺失 `pillow-heif`，将无法读取 HEIC，缩略图退化为占位，转换会提示安装。

## 流程概览
```mermaid
graph TD
    A[添加/拖拽文件] --> B[选择输出目录]
    B --> C[导出设置(随格式切换)]
    C --> D[更多设置(高级参数)]
    D --> E[开始前预检(同名/目录)]
    E --> F[并发转换]
    F --> G[托盘通知/完成复位]
```

## 常见问题
- 导出总是某一种格式？开始前会自动把右侧导出设置应用到所有未完成任务，无需点击“应用到选中”。
- 看不到托盘图标？程序有图标后备方案；仍不可见可在系统托盘设置中启用显示。

## 备注
- 停止操作将尽量取消未启动任务；已在执行的任务会在完成当前图片后停止队列提交。

